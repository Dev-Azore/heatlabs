"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(middleware)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n// middleware.ts\n/**\r\n * Global Route Protection Middleware\r\n * \r\n * Purpose:\r\n * - Protects routes based on authentication state\r\n * - Handles redirects for auth and admin routes\r\n * - Uses getSession() with proper error handling to avoid AuthSessionMissingError\r\n * \r\n * Updated: Uses getSession() instead of getUser() to avoid missing session errors\r\n */ \n\nasync function middleware(request) {\n    // Create response object\n    let response = next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n    try {\n        // Create Supabase client with proper cookie handling\n        const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://knjhqjygkplullnsqmdk.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtuamhxanlna3BsdWxsbnNxbWRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5NDA1NTgsImV4cCI6MjA3MDUxNjU1OH0.VI-XbbWnxW5GMqhsoaUTGidGJ2nR9xa-DkFujvmxNLE\", {\n            cookies: {\n                getAll () {\n                    return request.cookies.getAll();\n                },\n                setAll (cookiesToSet) {\n                    cookiesToSet.forEach(({ name, value, options })=>{\n                        response.cookies.set(name, value, options);\n                    });\n                }\n            }\n        });\n        // ‚úÖ FIX: Use getSession() instead of getUser() to avoid AuthSessionMissingError\n        // getSession() reads from cookies without server validation, which is fine for middleware\n        const { data: { session } } = await supabase.auth.getSession();\n        const user = session?.user || null;\n        const path = request.nextUrl.pathname;\n        console.log(`Middleware: Path=${path}, User=${user ? user.id : 'none'}`);\n        // üîê Rule 1: Protect Dashboard Routes\n        if (path.startsWith('/dashboard')) {\n            if (!user) {\n                console.log('Redirecting to login from dashboard');\n                const redirectUrl = new URL('/auth/login', request.url);\n                redirectUrl.searchParams.set('returnUrl', path);\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(redirectUrl);\n            }\n        }\n        // üîê Rule 2: Protect Admin Routes\n        if (path.startsWith('/admin')) {\n            if (!user) {\n                console.log('Redirecting to login from admin');\n                const redirectUrl = new URL('/auth/login', request.url);\n                redirectUrl.searchParams.set('returnUrl', path);\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(redirectUrl);\n            }\n            // Check admin role\n            const { data: role, error: roleError } = await supabase.rpc('get_my_role');\n            if (roleError || !role || role !== 'admin' && role !== 'moderator') {\n                console.log('User not admin, redirecting to dashboard');\n                return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL('/dashboard', request.url));\n            }\n        }\n        // üîê Rule 3: Redirect Authenticated Users Away from Auth Pages\n        if (path.startsWith('/auth') && !path.includes('/callback') && user) {\n            console.log('User authenticated, redirecting from auth page');\n            const returnUrl = request.nextUrl.searchParams.get('returnUrl') || '/dashboard';\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.redirect(new URL(returnUrl, request.url));\n        }\n        return response;\n    } catch (error) {\n        console.error('Middleware error:', error);\n        // In case of error, allow the request to proceed\n        return response;\n    }\n}\nconst config = {\n    matcher: [\n        '/dashboard/:path*',\n        '/admin/:path*',\n        '/auth/:path*'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3BCQyxTQUFTO1FBQ1A7UUFDQTtRQUNBO0tBQ0Q7QUFDSCxFQUFDIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXHBjXFxEb3dubG9hZHNcXGhlYXRsYWJzX1xcbWlkZGxld2FyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBtaWRkbGV3YXJlLnRzXHJcbi8qKlxyXG4gKiBHbG9iYWwgUm91dGUgUHJvdGVjdGlvbiBNaWRkbGV3YXJlXHJcbiAqIFxyXG4gKiBQdXJwb3NlOlxyXG4gKiAtIFByb3RlY3RzIHJvdXRlcyBiYXNlZCBvbiBhdXRoZW50aWNhdGlvbiBzdGF0ZVxyXG4gKiAtIEhhbmRsZXMgcmVkaXJlY3RzIGZvciBhdXRoIGFuZCBhZG1pbiByb3V0ZXNcclxuICogLSBVc2VzIGdldFNlc3Npb24oKSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZyB0byBhdm9pZCBBdXRoU2Vzc2lvbk1pc3NpbmdFcnJvclxyXG4gKiBcclxuICogVXBkYXRlZDogVXNlcyBnZXRTZXNzaW9uKCkgaW5zdGVhZCBvZiBnZXRVc2VyKCkgdG8gYXZvaWQgbWlzc2luZyBzZXNzaW9uIGVycm9yc1xyXG4gKi9cclxuaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3NzcidcclxuaW1wb3J0IHsgTmV4dFJlc3BvbnNlLCB0eXBlIE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIC8vIENyZWF0ZSByZXNwb25zZSBvYmplY3RcclxuICBsZXQgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpXHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBDcmVhdGUgU3VwYWJhc2UgY2xpZW50IHdpdGggcHJvcGVyIGNvb2tpZSBoYW5kbGluZ1xyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoXHJcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXHJcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcclxuICAgICAge1xyXG4gICAgICAgIGNvb2tpZXM6IHtcclxuICAgICAgICAgIGdldEFsbCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3QuY29va2llcy5nZXRBbGwoKVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldEFsbChjb29raWVzVG9TZXQpIHtcclxuICAgICAgICAgICAgY29va2llc1RvU2V0LmZvckVhY2goKHsgbmFtZSwgdmFsdWUsIG9wdGlvbnMgfSkgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KG5hbWUsIHZhbHVlLCBvcHRpb25zKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICB9XHJcbiAgICApXHJcblxyXG4gICAgLy8g4pyFIEZJWDogVXNlIGdldFNlc3Npb24oKSBpbnN0ZWFkIG9mIGdldFVzZXIoKSB0byBhdm9pZCBBdXRoU2Vzc2lvbk1pc3NpbmdFcnJvclxyXG4gICAgLy8gZ2V0U2Vzc2lvbigpIHJlYWRzIGZyb20gY29va2llcyB3aXRob3V0IHNlcnZlciB2YWxpZGF0aW9uLCB3aGljaCBpcyBmaW5lIGZvciBtaWRkbGV3YXJlXHJcbiAgICBjb25zdCB7IGRhdGE6IHsgc2Vzc2lvbiB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKVxyXG4gICAgY29uc3QgdXNlciA9IHNlc3Npb24/LnVzZXIgfHwgbnVsbFxyXG5cclxuICAgIGNvbnN0IHBhdGggPSByZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWVcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgTWlkZGxld2FyZTogUGF0aD0ke3BhdGh9LCBVc2VyPSR7dXNlciA/IHVzZXIuaWQgOiAnbm9uZSd9YClcclxuXHJcbiAgICAvLyDwn5SQIFJ1bGUgMTogUHJvdGVjdCBEYXNoYm9hcmQgUm91dGVzXHJcbiAgICBpZiAocGF0aC5zdGFydHNXaXRoKCcvZGFzaGJvYXJkJykpIHtcclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1JlZGlyZWN0aW5nIHRvIGxvZ2luIGZyb20gZGFzaGJvYXJkJylcclxuICAgICAgICBjb25zdCByZWRpcmVjdFVybCA9IG5ldyBVUkwoJy9hdXRoL2xvZ2luJywgcmVxdWVzdC51cmwpXHJcbiAgICAgICAgcmVkaXJlY3RVcmwuc2VhcmNoUGFyYW1zLnNldCgncmV0dXJuVXJsJywgcGF0aClcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KHJlZGlyZWN0VXJsKVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g8J+UkCBSdWxlIDI6IFByb3RlY3QgQWRtaW4gUm91dGVzXHJcbiAgICBpZiAocGF0aC5zdGFydHNXaXRoKCcvYWRtaW4nKSkge1xyXG4gICAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnUmVkaXJlY3RpbmcgdG8gbG9naW4gZnJvbSBhZG1pbicpXHJcbiAgICAgICAgY29uc3QgcmVkaXJlY3RVcmwgPSBuZXcgVVJMKCcvYXV0aC9sb2dpbicsIHJlcXVlc3QudXJsKVxyXG4gICAgICAgIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3JldHVyblVybCcsIHBhdGgpXHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChyZWRpcmVjdFVybClcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ2hlY2sgYWRtaW4gcm9sZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHJvbGUsIGVycm9yOiByb2xlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnZ2V0X215X3JvbGUnKVxyXG4gICAgICBcclxuICAgICAgaWYgKHJvbGVFcnJvciB8fCAhcm9sZSB8fCAocm9sZSAhPT0gJ2FkbWluJyAmJiByb2xlICE9PSAnbW9kZXJhdG9yJykpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnVXNlciBub3QgYWRtaW4sIHJlZGlyZWN0aW5nIHRvIGRhc2hib2FyZCcpXHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvZGFzaGJvYXJkJywgcmVxdWVzdC51cmwpKVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g8J+UkCBSdWxlIDM6IFJlZGlyZWN0IEF1dGhlbnRpY2F0ZWQgVXNlcnMgQXdheSBmcm9tIEF1dGggUGFnZXNcclxuICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoJy9hdXRoJykgJiYgIXBhdGguaW5jbHVkZXMoJy9jYWxsYmFjaycpICYmIHVzZXIpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1VzZXIgYXV0aGVudGljYXRlZCwgcmVkaXJlY3RpbmcgZnJvbSBhdXRoIHBhZ2UnKVxyXG4gICAgICBjb25zdCByZXR1cm5VcmwgPSByZXF1ZXN0Lm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgncmV0dXJuVXJsJykgfHwgJy9kYXNoYm9hcmQnXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChyZXR1cm5VcmwsIHJlcXVlc3QudXJsKSlcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzcG9uc2VcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignTWlkZGxld2FyZSBlcnJvcjonLCBlcnJvcilcclxuICAgIC8vIEluIGNhc2Ugb2YgZXJyb3IsIGFsbG93IHRoZSByZXF1ZXN0IHRvIHByb2NlZWRcclxuICAgIHJldHVybiByZXNwb25zZVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBtYXRjaGVyOiBbXHJcbiAgICAnL2Rhc2hib2FyZC86cGF0aConLFxyXG4gICAgJy9hZG1pbi86cGF0aConLFxyXG4gICAgJy9hdXRoLzpwYXRoKicsXHJcbiAgXSxcclxufSJdLCJuYW1lcyI6WyJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJOZXh0UmVzcG9uc2UiLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsInJlc3BvbnNlIiwibmV4dCIsInN1cGFiYXNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiY29va2llcyIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJvcHRpb25zIiwic2V0IiwiZGF0YSIsInNlc3Npb24iLCJhdXRoIiwiZ2V0U2Vzc2lvbiIsInVzZXIiLCJwYXRoIiwibmV4dFVybCIsInBhdGhuYW1lIiwiY29uc29sZSIsImxvZyIsImlkIiwic3RhcnRzV2l0aCIsInJlZGlyZWN0VXJsIiwiVVJMIiwidXJsIiwic2VhcmNoUGFyYW1zIiwicmVkaXJlY3QiLCJyb2xlIiwiZXJyb3IiLCJyb2xlRXJyb3IiLCJycGMiLCJpbmNsdWRlcyIsInJldHVyblVybCIsImdldCIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});